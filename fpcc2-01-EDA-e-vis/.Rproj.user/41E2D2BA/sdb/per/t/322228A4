{
    "contents" : "---\ntitle: \"Algumas dicas sobre formas e medidas de correlação\"\nauthor: \"Nazareno Andrade\"\ndate: \"13 de março de 2016\"\noutput: html_document\n---\n\n```{r, message=FALSE}\nrequire(ggplot2, quietly = TRUE)\nrequire(GGally, quietly = TRUE)\nrequire(reshape, quietly = TRUE)\nrequire(dplyr, quietly = TRUE)\n```\n\n## Sobre forma e medida\n\nEm análise exploratória, com frequência queremos examinar se há associação entre duas variáveis numéricas. Conselho importante: não há um número apenas que possa lhe responder tudo sobre a associação entre as duas variáveis. As medidas de correlação que você usará servirão mais para complementar e quantificar observações feitas em gráficos de dispersão do que para lhe guiar. \n\nUm exemplo classico com quatro pares de variáveis cujas associações interessam: x1 e y1, x2 e y2, etc., o [quarteto de Anscombe](https://en.wikipedia.org/wiki/Anscombe%27s_quartet):\n\n```{r}\nsummary(anscombe)\n\n# um pouco de rearrumação primeiro. \n# (para entender melhor, você pode procurar sobre dados em formato\n# wide ou long no R)\nt1 <- melt(select(anscombe, 1:4), id = c())\nt2 <- melt(select(anscombe, 5:8), id = c())\nnames(t2) <- c(\"v2\", \"value2\")\ndados <- data.frame(vars = paste(t1$variable, \"e\", t2$v2), \n               v1 = t1$value, \n               v2 = t2$value2)\n```\n\nCalculando a correlação linear: \n\n```{r}\ndados %>% \n  group_by(vars) %>% \n  summarise(correlacao = cor(v1, v2, method = \"pearson\"))\n```\n\nE se olharmos os dados?\n\n```{r}\nggplot(dados, aes(v1, v2)) + \n  geom_point(color = \"darkorange\", size = 4, alpha = 0.7) + \n  theme_bw() + \n  scale_x_continuous(breaks = seq(0, 20, 2)) + \n  scale_y_continuous(breaks = seq(0, 12, 2)) + \n  expand_limits(x = 0, y = 0) + \n  facet_wrap(~ vars)\n```\n\nQuatro relações diferentes, mesma quantificação. Para o segundo grupo, não há uma relação linear. No 3o, há uma relação perfeita entre a maioria das observações, com uma exceção. No 4o grupo não há relação; há uma exceção que faz parecer que há uma relação.\n\nO que os outros coeficientes podem nos dizer? \n\n```{r}\ndados %>% \n  group_by(vars) %>% \n  summarise(pearson = cor(v1, v2, method = \"pearson\"), \n            spearman = cor(v1, v2, method = \"spearman\"),\n            kendall = cor(v1, v2, method = \"kendall\"))\n```\n\n-------------\n\n##Força e também direção\n\nDito isso, essa figura ajuda a lembrar a relação entre o valor esperado do coeficiente (linear) e vários tipos de associação entre duas variáveis:\n\n![da wikipedia](https://upload.wikimedia.org/wikipedia/commons/d/d4/Correlation_examples2.svg)\n\n\n-------------\n\n# Alguns testes gerando a relação\n\nRelação linear:\n\n```{r}\nset.seed(123)\nx <- rnorm(100) * 100\ntamanho_do_erro <- 50\ny <- 0.5 * x + rnorm(100) * tamanho_do_erro + 20\n\ndf <- data.frame(x = x, \n                 y = y)\n\nggplot(df, aes(x = x, y = y)) + \n  geom_point(colour = \"darkgrey\", size = 4) + \n  theme_bw()\n\ncor(df$x, df$y, method = \"pearson\")\n\n# Dobro de erro em torno de uma função linear f(x)\ndf$y <- 0.5 * x + rnorm(100) * tamanho_do_erro * 2 + 20\n\nggplot(df, aes(x = x, y = y)) + \n  geom_point(colour = \"darkgrey\", size = 4) + \n  theme_bw()\ncor(df$x, df$y, method = \"pearson\")\n```\n\nRelação não linear\n\n```{r}\nn = 100\ndf <- data.frame(x = runif(n, min= 1, max = 20))\ndf$y = 100 * exp(-1.2 * df$x) #+ rnorm(n, mean = 0.05, sd = 1)\n\nggplot(df, aes(x = x, y = y)) + \n  geom_point(colour = \"darkgrey\", size = 4) + \n  theme_bw()# + scale_y_log10() \n\n# tente descomentando o scale_y_log10 acima e veja o que acontece\n  \ncor(df$x, df$y)\ncor(df$x, df$y, method = \"spearman\")\ncor(df$x, df$y, method = \"kendall\")\n```\n\n\n------\n\n## Dica prática\n\nQuando considerando várias variáveis, o mais prático é usar uma matriz de gráficos de dispersão: \n\n```{r}\ndados <- read.csv(\"dados//Dados de alunos para as aulas de FPCC-report.csv\")\ndados <- dados %>% select(2, 3, 5, 7, 9) %>% filter(complete.cases(dados))\nnames(dados) <- c(\"curso\", \"sexo\", \"repositorios\", \"confianca.em.estatistica\", \n                  \"altura\")\n\nstr(dados)\n\n# require(GGally)\nggpairs(dados, params = c(binwidth = 2, alpha = 0.7))\n```\n\n------\n\n",
    "created" : 1457879851045.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "294732511",
    "id" : "322228A4",
    "lastKnownWriteTime" : 1458053556,
    "path" : "~/workspace/fpcc2-01-vars-escalas/correlacoes.Rmd",
    "project_path" : "correlacoes.Rmd",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}